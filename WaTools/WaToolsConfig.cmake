set(WATOOLS_DIR ${CMAKE_CURRENT_LIST_DIR})

include(${CMAKE_CURRENT_LIST_DIR}/functions_compile.cmake)
include(${CMAKE_CURRENT_LIST_DIR}/functions_deploy.cmake)
include(${CMAKE_CURRENT_LIST_DIR}/functions_git.cmake)
include(${CMAKE_CURRENT_LIST_DIR}/functions_qt.cmake)
include(${CMAKE_CURRENT_LIST_DIR}/functions_target.cmake)

option(WATOOLS_USE_AS_SUBDIRECTORY "Use WaTools as subdirectory" OFF)

if(IOS OR ANDROID)
   set(WATOOLS_USE_AS_SUBDIRECTORY ON)
endif()

foreach(COMPONENT ${WaTools_FIND_COMPONENTS})
   #message(STATUS "NEED WaTools component: ${COMPONENT}")
   if(WATOOLS_USE_AS_SUBDIRECTORY)
      if(TARGET WaTools${COMPONENT})
         message(STATUS "REUSE TARGET WaTools${COMPONENT}")
         link_libraries(WaTools${COMPONENT})
      else()
         message(STATUS "ADD WaTools${COMPONENT} as subdirectory")
         if(IOS)
            set(CMAKE_XCODE_ATTRIBUTE_EXCLUDED_ARCHS[sdk=iphonesimulator*] "arm64")      
         endif()
         add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../WaTools${COMPONENT} WaTools${COMPONENT})
      endif()
   endif()
   find_package(WaTools${COMPONENT} REQUIRED)
endforeach()

